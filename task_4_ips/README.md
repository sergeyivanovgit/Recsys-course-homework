# Домашняя работа 4 (5 баллов)
## Дедлайн
Работы принимаются до **11.12 18:00**.

## Требования
Работа должна быть выполнена на языке Python (версия не менее 3.7). Код должен быть написан аккуратно и читаемо, названия переменных должны отражать свою суть. Так же следует оставлять пояснения к своим подходам к решению.

Результат работы - ноутбук с вызываемым рабочим кодом и комментариями-пояснениями. Весь код должен быть закоммичен и создан Pull Request. На сайте курса, в разделе домашнии работы, **нужно отписаться**, что Ваш PR готов к проверке и прислать ссылку на PR. 


## Отправка ДЗ
Репозиторий: https://github.com/sergeyivanovgit/Recsys-course-homework

Правила создания директорий: 
- Создайте папку в формате фамилия.первая_буква_имени (например, ivanov.s). В ней создайте папку hw4.
- В папке hw4 должен быть результирующий нотбук, названный фамилия_первая_буква_имени.ipynb (например, ivanov_s.ipynb), и необходимые скрипты для решения.
- **Коммитить исходные данные не нужно!**

Пожалуйста, отнеситесь внимательно к отправке домашнего задания!

## Задание
Вам необходимо посчитать OPE метрику clipped ips на последнем дне. В качестве модели для оценки возьмите вашу линейную модель из первого задания(если не делали первое дз то возьмите FM из третьего). В качестве lambda возьмите 10.
Далее некоторые вводные чтобы посчитать правильно cips.

#### Reward
Считайте что ревард равен 1 если в наблюдении был клик и 0 в противном случае.

#### \pi_0
В данной задаче предполагается, что логгинг полиси это некоторая стохастическая полиси. В каждом событии соревновались два баннера. Победивший баннер это всегда banner_id0, а проигравший это banner_id1. В итоге banner_id0 это именно тот баннер, который был показан пользователю. banner_id0 совпадает почти всегда совпадает с banner_id, но есть случаи когда это не так, их стоит отфильтровать. Победитель в каждом событии определялся случайно согласно следующей логике:
- Подкидывались две нормальные величины N(coeff_sum0, g0^2) и N(coeff_sum1, g1^2) 
- Выбирался тот баннер чей семпл получался больше. 

На оснований этих данных вы можете посчитать \pi_0, для этого вам достаточно только в каждом событии определить вероятность того, что одна нормальная величина больше другой.

#### \pi_1
Здесь вы предполагаете что новое полиси в целом работает примерно также. Подкидывается N(coeff_sum0_new, g0^2) и N(coeff_sum1_new, g1^2). Где coeff_sum0_new и coeff_sum1_new суммы коэффициентов для banner_id0 и banner_id1, которые предиктит ваша модель. Вы можете их получить если примените logit функцию к вероятностям которые предиктит ваша модель. 

Важный момент. Те предикты которые у вас уже имеются, они работают для banner_id0, потому что он совпадает с banner_id. Но вам еще нужно получить предикты для banner_id1. Для этого следует подставить в тест сете вместо banner_id значение banner_id1. 

После получения coeff_sum0_new и coeff_sum1_new ваша задача опять сводится к сравнению нормальных величин.

**Опциональная подзадача: Найти оптимальную регуляризацию по метрике cips.**

Данные лежат здесь: https://drive.google.com/drive/folders/1sxIGN-GUsJJcDF9WSg3Kzrgmzu1gp4PO

### Данные
Данные - это реальный лог реальных рекламных событий ad network Propeller Ads, тот же, что и в первой домашней работе.

Датасет состоит из показов рекламы. 

- date_time - время показа рекламы
- zone_id - id зоны, где зона - место на сайте для размещения рекламы
- banner_id - id баннера
- campaign_clicks - общее количество показов данной кампании (которой соотвествует баннер) данному юзеру, произошедшие до текущего показа
- os_id - id операционной системы
- country_id - id страны
- oaid_hash - хэш юзера
- banner_id0 - нулевой баннер в “стакане” баннеров
- banner_id1 - перый баннер в “стакане” баннеров
- rate0 - стоимость 1 клика установленная рекламодателем для banner_id0
- rate1 - стоимость 1 клика установленная рекламодателем для banner_id1
- g0 - стандартное суммы коэффициентов с banner_id0
- g1 - стандартное суммы коэффициентов с banner_id1
- coeff_sum0 - сумма коэффициентов для banner_id0
- coeff_sum1 - сумма коэффициентов для banner_id1
- impressions - был ли показ
- clicks - был ли клик

Для Домашней работы 4, колонка campaign_clicks не нужна.

## Вопросы
Все вопросы просьба задавать в чат, чтобы другие студенты могли найти ответы на схожие вопросы.
